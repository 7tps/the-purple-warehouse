<div class="navbar-backdrop hidden"></div>
<nav class="navbar hidden">
    <div class="navbar-header">
        <h1>TPW Scouting App</h1>
        <button class="navbar-close-btn"></button>
    </div>
    <a data-page="home">Home</a>
    <a data-page="scan-data">Upload Data</a>
    <a data-page="view-data">View Data/Analysis</a>
    <a data-page="compare-teams">Compare Teams</a>
    <a data-page="log-out">Log Out</a>
</nav>
<header>
    <button class="navbar-open-btn"></button>
    <h3>{{shorten username 10}} ({{team}})</h3>
    <div class="header-incentives">
      <div class="currency">
        <div class="nuts">
          <p>{{ incentives.nuts }}</p>
          <img src="/img/nuts.png" />
        </div>
        <div class="bolts">
          <p>{{ incentives.bolts }}</p>
          <img src="/img/bolts.png" />
        </div>
      </div>
      <div class="xp">
        <div class="xp-container">
          <div class="xp-filled" style="width: {{ percent incentives.progress }};"></div>
          <p>{{ incentives.level }}</p>
        </div>
      </div>
    </div>
</header>

<script defer>
    const navbar = document.querySelector(".navbar");
    const backdrop = document.querySelector(".navbar-backdrop");
    window.readerForNav = {
      stop: () => {}
    };

    function openNavbar() {
        navbar.classList.remove("hidden");
        backdrop.classList.remove("hidden");
        setTimeout(() => {
            navbar.classList.add("open");
            backdrop.classList.add("open");
        }, 0);
    }

    function closeNavbar() {
        navbar.classList.remove("open");
        backdrop.classList.remove("open");
        setTimeout(() => {
            navbar.classList.add("hidden");
            backdrop.classList.add("hidden");
        }, 250);
    }

    document.querySelector(".navbar-open-btn").onclick = openNavbar;
    document.querySelector(".navbar-close-btn").onclick = closeNavbar;
    backdrop.onclick = closeNavbar;

    document.querySelector(".navbar a[data-page='home']").onclick =
        async () => {
          window.location.hash = "#/";
          // await sdk.showHomePage();
        };
    document.querySelector(".navbar a[data-page='scan-data']").onclick =
        async () => {
          window.location.hash = "#/scan-data";
          // window.readerForNav = await sdk.showScannerPage();
        };
    document.querySelector(".navbar a[data-page='view-data']").onclick =
        async () => {
          window.location.hash = "#/view-data";
          // await sdk.showDataPage();
        };
    document.querySelector(".navbar a[data-page='compare-teams']").onclick =
        async () => {
          window.location.hash = "#/compare-teams";
          // await sdk.showComparePage();
        };
    document.querySelector(".navbar a[data-page='log-out']").onclick =
        async () => {
            window.location.href = "#/scouting/logout";
        };

    async function updatePage() {
        if(window.location.hash != null && window.location.hash.startsWith("#/")) {
            let page = window.location.hash.substring(2);
            if(page == "scan-data") {
                document.querySelector(".navbar a[data-page='scan-data']").classList.add("active");
                window.readerForNav = await sdk.showScannerPage();
            } else if(page == "view-data") {
                document.querySelector(".navbar a[data-page='view-data']").classList.add("active");
                await sdk.showDataPage();
            } else if(page == "compare-teams") {
                document.querySelector(".navbar a[data-page='compare-teams']").classList.add("active");
                await sdk.showComparePage();
            } else {
                document.querySelector(".navbar a[data-page='home']").classList.add("active");
                await sdk.showHomePage();
            }
        } else {
            document.querySelector(".navbar a[data-page='home']").classList.add("active");
            await sdk.showHomePage();
        }
    }
    window.onhashchange = () => {
        updatePage();
    }
    updatePage();

    document.querySelectorAll(".navbar a").forEach((a) => {
        a.addEventListener("click", async () => {
            if (window.readerForNav) {
                try {
                    await window.readerForNav.stop();
                } catch (err) {}
            }

            document.querySelector(".navbar a.active").classList.remove("active");
            a.classList.add("active");
            
            closeNavbar();
        });
    });
</script>